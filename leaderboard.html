<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>DellCTF-Leaderboard</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        body {
            padding-top: 30px;
        }
        
        .widget .panel-body {
            padding: 0px;
        }
        
        .widget .list-group {
            margin-bottom: 0;
        }
        
        .widget .panel-title {
            display: inline
        }
        
        .widget .label-info {
            float: right;
        }
        
        .widget li.list-group-item {
            border-radius: 0;
            border: 0;
            border-top: 1px solid #ddd;
        }
        
        .widget li.list-group-item:hover {
            background-color: rgba(86, 61, 124, .1);
        }
        
        .widget .mic-info {
            color: #666666;
            font-size: 11px;
        }
        
        .widget .action {
            margin-top: 5px;
        }
        
        .widget .comment-text {
            font-size: 12px;
        }
        
        .widget .btn-block {
            border-top-left-radius: 0px;
            border-top-right-radius: 0px;
        }
        
        td,
        th {
            text-align: left !important;
        }
    </style>
</head>

<body>

    <div class="row">
        <div class="col-md-1"></div>

        <div class="col-md-10 text-center">
            <h1>Live Scores</h1>
            <p id="refresh"></p>
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-1"></div>
        <div class="col-md-10" >
            <div class="row">
                <div class="col-md-8" style="display:none">
                    <div class="panel panel-default widget">
                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-comment"></span>
                            <h3 class="panel-title">
                                Latest Updates
                            </h3>
                            <span class="label label-info"></span>
                        </div>
                        <div class="panel-body">
                            <ul class="list-group" id="list" style='height:70%'>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="panel panel-default widget">
                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-comment"></span>
                            <h3 class="panel-title">
                                Leaderboard
                            </h3>
                            <span class="label label-info"></span>
                        </div>
                        <div class="panel-body">
                            <table class="table table-hovered" id="leaderboard" >

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <script>
       url = "https://api.github.com/search/"
users = ["jonnavithulagirish","modugunikhitha","keerthim1998","ninjahainge3", "pratikshapanpaliya", 'tawlinkaur', 'gp886', 'aashnamimi', 'ankitaugalmugale', 'husnimubarack', 'rhtkumar021', 'ishank09', "bachittarjeet", 'niharika-cnr-dell', 'shivangkeshari', 'jyotikarajpal', 'himanshubhawra', 'suryadevaraj', 'sr2212', 'kushika', 'automationboi', 'sahityayo', 'padam2403', 'haripriyadepura', 'archana-dev', 'itsmesouvik1', 'pape10', 'hrbr175', 'subhisingh', 'pujamishra123', 'anjali10081996', 'nd265', 'juniper-23', 'thspreetham98', 'iamrahul1024', 'samin-batra', 'anuhyaalluri', 'kaushambi2612', 'priyanka-Lenka', 'krutee05', 'sai-krithika', 'erress', 'parul-sinha', 'kathakali123', 'harsh-khanna', 'shreyashi2104', 'goenkanikunj', 'maverickwareZ', 'anshika1804', 'harshajoshi349', 'travellerAM', 'anirudhbagri', 'somya-maheshwari', 'twinklejaswani', 'nishantbatra', 'tellakulasatya', 'moasc', 'sanchari-roy', 'ash11R', 'gdakshita', 'saurabh1969', 'sonurex', 'kapilmodi']
j = 0;
scores = []
for (var k = 0; k < users.length; k++) {
    scores.push({
        "username": users[k]
    });
    scores[k]['scores'] = 0;
}

var refreshIntervalId = setInterval(function() {
    jsonResponse = []
    if (j == users.length) {
        alert("Leaderboard Hass ben Loaded");
        clearInterval(refreshIntervalId);
    }
    if (j < users.length) {

        var api = url + "issues?q=author:" + users[j] + " type:pull";
        console.log(api)
        fetch(api).then(response => {
            const result = response.json()
            return result
        }).then(response => {
            //console.log(response)
            //scores.push({
            //    "username": users[j]
            //})
            scores[j]["scores"] = 0;
            jsonResponse.push(response)
            if (response.total_count > 0) {
                response.items.forEach(i => {
                    try {
                        var postdate = i.created_at.split("T")[0].split('-')
                        var curdate = new Date(postdate[0], postdate[1], postdate[2])
                        var startdate = new Date("2019", "10", "16")
                        var enddate = new Date("2019", "10", "31")

                        i.node_id = i.node_id.split('=')[0]
                        if (curdate.getTime() > startdate.getTime() && curdate.getTime() < enddate.getTime()) {
                            $("#list").append('<li class="list-group-item"><div class="row"><div class="col-xs-2 col-md-1"><img src="' + i.user.avatar_url + '" class="img-circle img-responsive" width=80 alt="" /></div><div class="col-xs-10 col-md-11" id="' + i.node_id.split('=')[0] + '"><div><a href="' + i.html_url + '"">' + i.body + '</a><div class="mic-info">By: <a href="' + i.user.url + '">' + i.user.login + '</a> on <a href="' + i.repository_url + '">' + i.repository_url.split('https://api.github.com/repos/')[1] + '</a>  at ' + i.created_at.split('T')[0] + ' ' + i.created_at.split('T')[1].split("Z")[0] + '</div></div><div class="comment-text">' + i.title + '</div><div class="action"><button type="button" class="btn btn-primary btn-xs" title="Edit">' + i.state + '</button></div></div></div></li>');
                            var index = users.findIndex(user => user == i.user.login.toLowerCase());
                            //console.log(index)
                            if (i.state == "closed") {
                                scores[index]["scores"] += 5;
                                $("#" + i.node_id + " .btn").addClass('btn-success');
                            } else if (i.state == "open") {
                                scores[index]["scores"] += 1;
                                $("#" + i.node_id + " .btn").addClass('btn-warning');
                            } else {
                                $("#" + i.node_id + " .btn").addClass('btn-danger');
                            }
                        }
                    } catch (Exception) {
                        // console.log(Exception)
                    }

                })
            }
            $("#leaderboard").empty();
            $("#leaderboard").append("<tr><th>Name</th><th>Score</th></tr>")

            scores.sort(function(a, b) {
                    return b.scores - a.scores
                })
                //console.log(scores)
            for (var i = 0; i < scores.length; i++) {
                $("#leaderboard").append("<tr><td>" + scores[i]['username'] + "</td><td>" + scores[i]['scores'] + "</td></tr>")
            }
            $("#refresh").html("Last refreshed at " + new Date().getHours() + " :" + new Date().getMinutes())
            j++;
        })

    } else {
        j++;
    }
}, 10000)
    </script>
</body>

</html>